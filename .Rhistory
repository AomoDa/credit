log_info("开始处理程序：","数据日期 = ",as.character(now_date))
#----------------------------------------------------------------
# 基础素质
#----------------------------------------------------------------
log_info("Start - 基础素质")
# 个人背景 - 教育背景
rlt$education = credit_education(vec = kpi.dat$education[kpi.dat$date==now_date],env = env)
# # 个人背景 - 特长
# rlt$hobby = credit_hobby(vec=NA,env=env)
# 个人背景 - 政治背景
rlt$political = credit_political(vec_party = kpi.dat$party[kpi.dat$date==now_date],env = env)
# 司龄
rlt$entry = credit_entry(vec = kpi.dat$entry_date[kpi.dat$date==now_date],env = env,now_date=now_date)
#执业认证
rlt$qualification = credit_qualification(vec = kpi.dat$qualification[kpi.dat$date==now_date],env = env)
# 每日一考
rlt$exam = credit_score(id=rlt$id,
sdat=credit_exam(dat=kpi.dat,now_date=now_date,env=env))
# 汇总
rlt$base = rlt$education  + rlt$political + rlt$entry + rlt$qualification + rlt$exam
log_info("End - 基础素质")
#----------------------------------------------------------------
# 行为规范
#----------------------------------------------------------------
log_info("Start - 行为规范")
# 日常行为规范
rlt$daily = credit_score(id=rlt$id,
sdat=credit_daily(kpi.dat,env=env,now_date=now_date,last_dat=last_dat),
default=env$behavior$daily$total)
# 行政处罚
rlt$punish = credit_score(id=rlt$id,
sdat=credit_punish(gg.dat,env=env,now_date=now_date,last_dat=last_dat),
default=env$behavior$punish$total)
# 汇总
rlt$behavior = rlt$daily + rlt$punish
log_info("End - 行为规范")
#----------------------------------------------------------------
# 品质服务
#----------------------------------------------------------------
log_info("Start - 品质服务")
# 客户投诉
rlt$complaint = credit_score(id=rlt$id,
sdat=credit_complaint(gg.dat,env=env,now_date=now_date,last_dat=last_dat),
default=env$service$complaint$total)
# 客户评价 - 客户表扬
rlt$praise = credit_score(id=rlt$id,
sdat=credit_praise(gg.dat,env=env,now_date=now_date))
# NPS
rlt$nps = credit_score(id=rlt$id,
sdat=credit_nps(dat=kpi.dat,nps.dat=nps.dat,env=env,now_date=now_date))
# 经验值
rlt$jingyan = credit_score(id=rlt$id,
sdat=credit_jingyan(dat=kpi.dat,env=env,now_date=now_date))
# 汇总
rlt$service = rlt$complaint + rlt$praise + rlt$nps + rlt$jingyan
log_info("End - 品质服务")
#----------------------------------------------------------------
# 参与贡献
#----------------------------------------------------------------
log_info("Start - 参与贡献")
# 楼盘信息维护
rlt$xiaoqu = credit_score(id=rlt$id,
sdat=credit_xiaoqu(dat=kpi.dat,env=env,now_date=now_date))
# 师徒带训
rlt$teacher = credit_teacher(dat=kpi.dat,env=env,now_date=now_date)
# 推荐入职
rlt$recommend = credit_recommend(dat=kpi.dat,env=env,now_date=now_date)
# 社会活动参与
rlt$social = credit_social (dat=kpi.dat,env=env,now_date=now_date)
# 其他事项
rlt$other = credit_other(dat=kpi.dat,env=env,now_date=now_date)
# 汇总
rlt$contribute = rlt$xiaoqu + rlt$teacher + rlt$recommend + rlt$social + rlt$other
log_info("End - 参与贡献")
#----------------------------------------------------------------
# 业务能力 - 官网指标
#----------------------------------------------------------------
log_info("Start - 官网指标")
rlt$app = credit_score(id=rlt$id,
sdat=credit_app_download(kpi.dat,env=env,now_date=now_date))
rlt$call_answer = credit_score(id=rlt$id,
sdat=credit_call_answer(kpi.dat,env=env,now_date=now_date))
rlt$al_1min = credit_score(id=rlt$id,
sdat=credit_al_1min(kpi.dat,env=env,now_date=now_date))
rlt$al_3day = credit_score(id=rlt$id,
sdat=credit_al_3day(kpi.dat,env=env,now_date=now_date))
rlt$al_luru = credit_score(id=rlt$id,
sdat=credit_al_luru(kpi.dat,env=env,now_date=now_date))
rlt$al_daikan = credit_score(id=rlt$id,
sdat=credit_al_daikan(kpi.dat,env=env,now_date=now_date))
# 汇总
rlt$gw = rlt$app + rlt$call_answer + rlt$al_1min + rlt$al_3day +
rlt$al_luru + rlt$al_daikan
log_info("End - 官网指标")
#----------------------------------------------------------------
# 业务能力 - 买卖
#----------------------------------------------------------------
log_info("Start - 买卖指标")
# rlt$mm_deal = credit_score(id=rlt$id,
# 	sdat=credit_mm_deal(kpi.dat,env=env,now_date=now_date))
# 速销
rlt$mm_s_sx = credit_score(id=rlt$id,
sdat=credit_mm_s_sx(kpi.dat,env=env,now_date=now_date))
rlt$mm_c_sx = credit_score(id=rlt$id,
sdat=credit_mm_c_sx(kpi.dat,env=env,now_date=now_date))
# 转介客源
rlt$mm_zjky = credit_score(id=rlt$id,
sdat=credit_mm_zjky(kpi.dat,env=env,now_date=now_date))
# 折扣
rlt$mm_zk = credit_score(id=rlt$id,
sdat=credit_mm_zk(kpi.dat,env=env,now_date=now_date))
# 带看
rlt$mm_cxz = credit_score(id=rlt$id,
sdat=credit_mm_cxz(kpi.dat,env=env,now_date=now_date))
rlt$mm_cdk = credit_score(id=rlt$id,
sdat=credit_mm_cdk(kpi.dat,env=env,now_date=now_date))
# 房源、委托、钥匙
rlt$mm_fxz = credit_score(id=rlt$id,
sdat=credit_mm_fxz(kpi.dat,env=env,now_date=now_date))
rlt$mm_wt = credit_score(id=rlt$id,
sdat=credit_mm_wt(kpi.dat,env=env,now_date=now_date))
rlt$mm_ys = credit_score(id=rlt$id,
sdat=credit_mm_ys(kpi.dat,env=env,now_date=now_date))
# 汇总
rlt$mm = rlt$mm_s_sx + rlt$mm_c_sx + rlt$mm_zk + rlt$mm_cxz +
rlt$mm_cdk +rlt$mm_fxz + rlt$mm_wt + rlt$mm_ys
log_info("End - 买卖指标")
#----------------------------------------------------------------
# 业务能力 - 租赁
#----------------------------------------------------------------
log_info("Start - 租赁指标")
# 收房管
rlt$zl_sfg = credit_score(id=rlt$id,
sdat=credit_zl_sfg(kpi.dat,env=env,now_date=now_date))
# # 合作出房
rlt$zl_fhz = credit_score(id=rlt$id,
sdat=credit_zl_fhz(kpi.dat,env=env,now_date=now_date))
# 出着火房管
rlt$zl_czh = credit_score(id=rlt$id,
sdat=credit_zl_czh(kpi.dat,env=env,now_date=now_date))
# 在管量 、委托
rlt$zl_zg = credit_score(id=rlt$id,
sdat=credit_zl_zg(kpi.dat,env=env,now_date=now_date))
rlt$zl_wt = credit_score(id=rlt$id,
sdat=credit_zl_wt(kpi.dat,env=env,now_date=now_date))
# 首看新增客户 、房源新增、普租实勘
rlt$zl_cxz = credit_score(id=rlt$id,
sdat=credit_zl_cxz(kpi.dat,env=env,now_date=now_date))
rlt$zl_fxz = credit_score(id=rlt$id,
sdat=credit_zl_fxz(kpi.dat,env=env,now_date=now_date))
rlt$zl_pzsk = credit_score(id=rlt$id,
sdat=credit_zl_pzsk(kpi.dat,env=env,now_date=now_date))
log_info("End - 租赁指标")
# 汇总
rlt$zl = rlt$zl_sfg + rlt$zl_fhz + rlt$zl_czh + rlt$zl_zg +
rlt$zl_wt +  rlt$zl_cxz + rlt$zl_fxz + rlt$zl_pzsk
return(rlt)
}
# 计算历史全部
run <- function(kpi.dat,gg.dat,env) {
order_date = sort(unique(kpi.dat$date))
for (i in seq_len(length(order_date))) {
if(i==1){
rlt = run_mon(kpi.dat,gg.dat,
now_date=order_date[i],env=env)
}else{
tmp = run_mon(kpi.dat,gg.dat,
now_date=order_date[i],env=env,
last_dat=rlt[rlt$credit_date==order_date[i-1],])
rlt = rbind(rlt,tmp)
}
}
# 关联经纪人身份
rlt$business_type = ifelse(str_count(rlt$qu,pattern = "A"),"zl","mm")
# 处理错误数据
rlt$zl[rlt$business_type=="mm"] = 0
rlt$mm[rlt$business_type=="zl"] = 0
rlt$score = rlt$base + rlt$behavior + rlt$service +
rlt$contribute + rlt$gw + rlt$mm + rlt$zl
return(rlt)
}
# # 计算
finalScore = run(kpi.dat,gg.dat,env)
write_xlsx(finalScore,"finalScore.xlsx")
hist(finalScore$score[finalScore$credit_date==as.Date("2021-03-01")])
hist(finalScore$score[finalScore$credit_date==as.Date("2021-03-01")],breaks = 50)
source("data/clean.R")
dim(kpi.dat)
library(readxl)
library(dplyr)
library(writexl)
library(stringr)
# setwd("Documents/credit/")
# jjrDataPath = "data/积分系统测试所需员工数据5.1.xlsx"
jjrDataPath="data/data0521.xlsx"
ggDataPath="data/gg0521.xlsx"
#----------------------------------------------------------------
# 经纪人过程指标数据
#----------------------------------------------------------------
# loading data
shtFormat <- function(sht){
s = unlist(strsplit(x = str_remove_all(str_remove_all(string = sht,pattern = " "),"月"),split = "[.]"))
rt = paste0(s[1],"-",ifelse(nchar(s[2])==1,paste0("0",s[2]),s[2]),"-01")
return(as.Date(rt))
}
# 读取单个SHEET
readSheet <- function(sht) {
dat = read_xlsx(path = jjrDataPath,sheet = sht,na="无",col_types=c(rep("guess",8),rep("text",45)))
names(dat) <- c(
# 大区	区域	店组	岗位	姓名	职级	ERP编号	入职日期
"daqu","qu","zu","job","name","level","id","entry_date",
# 学历	是否党员	司龄（月）	执业认证
"education","party","entry_month","qualification",
# 每日一考	日常行为规范（迟到）	日常行为规范（旷工）、经验值单数	nps
"exam",  "daily_cd","daily_kg", "jingyan", "nps_n","nps_s","nps",
# 渗透量	400来电量	400接通量	400接通率
"app_download","call_400","answer_400","call_answer",
# 爱聊客户量	爱聊1分钟回复量	爱聊1分钟回复率
"cnt_al","cnt_al_1min","al_1min",
# 爱聊线索量	三日复聊量	爱聊三日复聊率
"dcnt_al","dcnt_al_3day","al_3day",
# 爱聊线索量	爱聊客户转录入量	爱聊转录入率
"dcnt_al_2","dcnt_al_luru","al_luru",
# 爱聊线索量	线索转首看量	线索转首看率
"dcnt_al_3","dcnt_al_daikan","al_daikan",
# 小区楼盘纠错
# "xiaoqu",
# 买卖收速销房	买卖出速销房	转介客源（暂无数据）	买卖折扣达标量
"mm_s_sx","mm_c_sx","mm_zjky","mm_zk",
# 买卖新增客户	买卖总带看客户组数	 买卖房源新增	买卖认证委托量	买卖收钥匙量
"mm_cxz","mm_cdk","mm_fxz","mm_wt","mm_ys",
# 租赁房管收房	我收他出+他收我出,出着火房管
"zl_sfg","zl_fhz_wstc","zl_fhz_tswc","zl_czh",
# 租赁在管量	租赁委托续签量	租赁新增首看客户	租赁房源新增	租赁普租实勘
"zl_zg","zl_wt","zl_cxz","zl_fxz","zl_pzsk"
)
# 处理数据类型
dat$entry_date <- as.Date(dat$entry_date)
dat$id <- as.numeric(dat$id)
dat$entry_month <- as.numeric(dat$entry_month)
dat[,c(13:53)] <- as.data.frame(apply(X = dat[,c(13:53)],MARGIN = 2,FUN = as.numeric))
dat$date <- shtFormat(sht)
# 删除错误数据
entry_date_num <- as.numeric(substr(dat$entry_date,1,4)) * 12 + as.numeric(substr(dat$entry_date,6,7))
data_date_num <- as.numeric(substr(dat$date,1,4)) * 12 + as.numeric(substr(dat$date,6,7))
dat = dat[data_date_num > entry_date_num,]
return(as.data.frame(dat))
}
# 批量读取并合并数据
readData <- function() {
shts <- excel_sheets(jjrDataPath)
# shts <- shts[5:18]
dat <- data.frame()
for (sht in shts) {
cat(sht,"\n")
if(nrow(dat)==0){
dat = readSheet(sht)
}else{
tmp = readSheet(sht)
dat = rbind(dat,tmp)
}
}
return(dat)
}
# miss
fill <- function(vec,default=0){
a = vec
a[is.na(a)] = 0
return(a)
}
kpi.dat = readData()
kpi.dat[13:53] <- as.data.frame( apply(X = kpi.dat[13:53],MARGIN = 2,FUN = fill))
kpi.dat$business = ifelse(str_count(kpi.dat$qu,pattern = "A"),"zl","mm")
write.csv(x = kpi.dat,file = "kpi.csv",row.names = FALSE)
dim(kpi.dat)
finalScore = run(kpi.dat,gg.dat,env)
hist(finalScore$score[finalScore$credit_date==as.Date("2021-03-01")],breaks = 50)
write.csv(x = finalScore,file = "finalScore.csv",row.names =FALSE)
rule=env$service$jingyan
rule
dat %>%
filter(date == now_date) %>%
select(id,jingyan)
now_date
dat = kpi.dat
dat %>%
filter(date == now_date) %>%
select(id,jingyan)
names
names(dat)
rule$score$mm12
rule$score$zl
dat %>%
filter(date == now_date) %>%
select(id,jingyan,business)%>%
mutate(ss=if_else(business=="mm", rule$score$mm12,rule$score$zl)) %>%
mutate(s = ss * jingyan)
dat %>%
filter(date == now_date) %>%
select(id,jingyan,business)%>%
mutate(ss=if_else(business=="mm", rule$score$mm12,rule$score$zl)) %>%
mutate(s = ss * jingyan)%>%
mutate(s = if_else(s >= rule$total, rule$total,s )) %>%
select(id,s) %>%
as.data.frame()
credit_jingyan <- function(dat,env,now_date){
rule=env$service$jingyan
dat %>%
filter(date == now_date) %>%
select(id,jingyan,business)%>%
mutate(ss=if_else(business=="mm", rule$score$mm12,rule$score$zl)) %>%
mutate(s = ss * jingyan)%>%
mutate(s = if_else(s >= rule$total, rule$total,s )) %>%
select(id,s) %>%
as.data.frame()
}
library(logger)
# 计算一个月
run_mon <- function(kpi.dat,gg.dat,now_date,env,last_dat=NULL) {
now_date = as.Date(now_date)
rlt = kpi.dat[kpi.dat$date==now_date,c(1:8)]
rlt$credit_date = now_date
log_info("开始处理程序：","数据日期 = ",as.character(now_date))
#----------------------------------------------------------------
# 基础素质
#----------------------------------------------------------------
log_info("Start - 基础素质")
# 个人背景 - 教育背景
rlt$education = credit_education(vec = kpi.dat$education[kpi.dat$date==now_date],env = env)
# # 个人背景 - 特长
# rlt$hobby = credit_hobby(vec=NA,env=env)
# 个人背景 - 政治背景
rlt$political = credit_political(vec_party = kpi.dat$party[kpi.dat$date==now_date],env = env)
# 司龄
rlt$entry = credit_entry(vec = kpi.dat$entry_date[kpi.dat$date==now_date],env = env,now_date=now_date)
#执业认证
rlt$qualification = credit_qualification(vec = kpi.dat$qualification[kpi.dat$date==now_date],env = env)
# 每日一考
rlt$exam = credit_score(id=rlt$id,
sdat=credit_exam(dat=kpi.dat,now_date=now_date,env=env))
# 汇总
rlt$base = rlt$education  + rlt$political + rlt$entry + rlt$qualification + rlt$exam
log_info("End - 基础素质")
#----------------------------------------------------------------
# 行为规范
#----------------------------------------------------------------
log_info("Start - 行为规范")
# 日常行为规范
rlt$daily = credit_score(id=rlt$id,
sdat=credit_daily(kpi.dat,env=env,now_date=now_date,last_dat=last_dat),
default=env$behavior$daily$total)
# 行政处罚
rlt$punish = credit_score(id=rlt$id,
sdat=credit_punish(gg.dat,env=env,now_date=now_date,last_dat=last_dat),
default=env$behavior$punish$total)
# 汇总
rlt$behavior = rlt$daily + rlt$punish
log_info("End - 行为规范")
#----------------------------------------------------------------
# 品质服务
#----------------------------------------------------------------
log_info("Start - 品质服务")
# 客户投诉
rlt$complaint = credit_score(id=rlt$id,
sdat=credit_complaint(gg.dat,env=env,now_date=now_date,last_dat=last_dat),
default=env$service$complaint$total)
# 客户评价 - 客户表扬
rlt$praise = credit_score(id=rlt$id,
sdat=credit_praise(gg.dat,env=env,now_date=now_date))
# NPS
rlt$nps = credit_score(id=rlt$id,
sdat=credit_nps(dat=kpi.dat,nps.dat=nps.dat,env=env,now_date=now_date))
# 经验值
rlt$jingyan = credit_score(id=rlt$id,
sdat=credit_jingyan(dat=kpi.dat,env=env,now_date=now_date))
# 汇总
rlt$service = rlt$complaint + rlt$praise + rlt$nps + rlt$jingyan
log_info("End - 品质服务")
#----------------------------------------------------------------
# 参与贡献
#----------------------------------------------------------------
log_info("Start - 参与贡献")
# 楼盘信息维护
rlt$xiaoqu = credit_score(id=rlt$id,
sdat=credit_xiaoqu(dat=kpi.dat,env=env,now_date=now_date))
# 师徒带训
rlt$teacher = credit_teacher(dat=kpi.dat,env=env,now_date=now_date)
# 推荐入职
rlt$recommend = credit_recommend(dat=kpi.dat,env=env,now_date=now_date)
# 社会活动参与
rlt$social = credit_social (dat=kpi.dat,env=env,now_date=now_date)
# 其他事项
rlt$other = credit_other(dat=kpi.dat,env=env,now_date=now_date)
# 汇总
rlt$contribute = rlt$xiaoqu + rlt$teacher + rlt$recommend + rlt$social + rlt$other
log_info("End - 参与贡献")
#----------------------------------------------------------------
# 业务能力 - 官网指标
#----------------------------------------------------------------
log_info("Start - 官网指标")
rlt$app = credit_score(id=rlt$id,
sdat=credit_app_download(kpi.dat,env=env,now_date=now_date))
rlt$call_answer = credit_score(id=rlt$id,
sdat=credit_call_answer(kpi.dat,env=env,now_date=now_date))
rlt$al_1min = credit_score(id=rlt$id,
sdat=credit_al_1min(kpi.dat,env=env,now_date=now_date))
rlt$al_3day = credit_score(id=rlt$id,
sdat=credit_al_3day(kpi.dat,env=env,now_date=now_date))
rlt$al_luru = credit_score(id=rlt$id,
sdat=credit_al_luru(kpi.dat,env=env,now_date=now_date))
rlt$al_daikan = credit_score(id=rlt$id,
sdat=credit_al_daikan(kpi.dat,env=env,now_date=now_date))
# 汇总
rlt$gw = rlt$app + rlt$call_answer + rlt$al_1min + rlt$al_3day +
rlt$al_luru + rlt$al_daikan
log_info("End - 官网指标")
#----------------------------------------------------------------
# 业务能力 - 买卖
#----------------------------------------------------------------
log_info("Start - 买卖指标")
# rlt$mm_deal = credit_score(id=rlt$id,
# 	sdat=credit_mm_deal(kpi.dat,env=env,now_date=now_date))
# 速销
rlt$mm_s_sx = credit_score(id=rlt$id,
sdat=credit_mm_s_sx(kpi.dat,env=env,now_date=now_date))
rlt$mm_c_sx = credit_score(id=rlt$id,
sdat=credit_mm_c_sx(kpi.dat,env=env,now_date=now_date))
# 转介客源
rlt$mm_zjky = credit_score(id=rlt$id,
sdat=credit_mm_zjky(kpi.dat,env=env,now_date=now_date))
# 折扣
rlt$mm_zk = credit_score(id=rlt$id,
sdat=credit_mm_zk(kpi.dat,env=env,now_date=now_date))
# 带看
rlt$mm_cxz = credit_score(id=rlt$id,
sdat=credit_mm_cxz(kpi.dat,env=env,now_date=now_date))
rlt$mm_cdk = credit_score(id=rlt$id,
sdat=credit_mm_cdk(kpi.dat,env=env,now_date=now_date))
# 房源、委托、钥匙
rlt$mm_fxz = credit_score(id=rlt$id,
sdat=credit_mm_fxz(kpi.dat,env=env,now_date=now_date))
rlt$mm_wt = credit_score(id=rlt$id,
sdat=credit_mm_wt(kpi.dat,env=env,now_date=now_date))
rlt$mm_ys = credit_score(id=rlt$id,
sdat=credit_mm_ys(kpi.dat,env=env,now_date=now_date))
# 汇总
rlt$mm = rlt$mm_s_sx + rlt$mm_c_sx + rlt$mm_zk + rlt$mm_cxz +
rlt$mm_cdk +rlt$mm_fxz + rlt$mm_wt + rlt$mm_ys
log_info("End - 买卖指标")
#----------------------------------------------------------------
# 业务能力 - 租赁
#----------------------------------------------------------------
log_info("Start - 租赁指标")
# 收房管
rlt$zl_sfg = credit_score(id=rlt$id,
sdat=credit_zl_sfg(kpi.dat,env=env,now_date=now_date))
# # 合作出房
rlt$zl_fhz = credit_score(id=rlt$id,
sdat=credit_zl_fhz(kpi.dat,env=env,now_date=now_date))
# 出着火房管
rlt$zl_czh = credit_score(id=rlt$id,
sdat=credit_zl_czh(kpi.dat,env=env,now_date=now_date))
# 在管量 、委托
rlt$zl_zg = credit_score(id=rlt$id,
sdat=credit_zl_zg(kpi.dat,env=env,now_date=now_date))
rlt$zl_wt = credit_score(id=rlt$id,
sdat=credit_zl_wt(kpi.dat,env=env,now_date=now_date))
# 首看新增客户 、房源新增、普租实勘
rlt$zl_cxz = credit_score(id=rlt$id,
sdat=credit_zl_cxz(kpi.dat,env=env,now_date=now_date))
rlt$zl_fxz = credit_score(id=rlt$id,
sdat=credit_zl_fxz(kpi.dat,env=env,now_date=now_date))
rlt$zl_pzsk = credit_score(id=rlt$id,
sdat=credit_zl_pzsk(kpi.dat,env=env,now_date=now_date))
log_info("End - 租赁指标")
# 汇总
rlt$zl = rlt$zl_sfg + rlt$zl_fhz + rlt$zl_czh + rlt$zl_zg +
rlt$zl_wt +  rlt$zl_cxz + rlt$zl_fxz + rlt$zl_pzsk
return(rlt)
}
# 计算历史全部
run <- function(kpi.dat,gg.dat,env) {
order_date = sort(unique(kpi.dat$date))
for (i in seq_len(length(order_date))) {
if(i==1){
rlt = run_mon(kpi.dat,gg.dat,
now_date=order_date[i],env=env)
}else{
tmp = run_mon(kpi.dat,gg.dat,
now_date=order_date[i],env=env,
last_dat=rlt[rlt$credit_date==order_date[i-1],])
rlt = rbind(rlt,tmp)
}
}
# 关联经纪人身份
rlt$business_type = ifelse(str_count(rlt$qu,pattern = "A"),"zl","mm")
# 处理错误数据
rlt$zl[rlt$business_type=="mm"] = 0
rlt$mm[rlt$business_type=="zl"] = 0
rlt$score = rlt$base + rlt$behavior + rlt$service +
rlt$contribute + rlt$gw + rlt$mm + rlt$zl
return(rlt)
}
# # 计算
finalScore = run(kpi.dat,gg.dat,env)
write.csv(x = finalScore,file = "finalScore.csv",row.names =FALSE)
hist(finalScore$jingyan)
hist(finalScore$jingyan[finalScore$credit_date=="2021-03-01"])
rule=env$service$jingyan
rule
summary(finalScore$jingyan[finalScore$credit_date=="2021-03-01"])
finalScore = run(kpi.dat,gg.dat,env)
